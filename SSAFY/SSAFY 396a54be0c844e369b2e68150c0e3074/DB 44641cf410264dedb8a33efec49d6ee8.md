# DB

### 목차

# 관계형 데이터 베이스

- 테이블 기반의 database
    - Table
        - 실제 데이터가 저장되는 곳
        - 행과 열의 2차원 구조를 가진 데이터 저장소
    - 데이터를 테이블 단위로 관리
        - 하나의 데이터(행, record)는 여러 속성(Attribute)을 가진다.
        - 데이터 중복을 최소화
- 스키마(Schema)
    - 데이터베이스에서 자료의 구조, 표현방법, 관계 등 전반적인 명세를 기술한 것
    - 테이블에 대한 명세서

# 설정하기

## JDBC(Java Database Connectivity)

- Java와 DB를 연결 : DB에 일관된 방식으로 접근할 수 있도록 API를 제공하는 클래스의 집합
- JDBC를 이용하여 DBMS와 SQL을 주고 받음
    - 쿼리한다 : 조회
    - 업데이트 : 삽입, 수정,삭제

### 연결방법

1. JDBC 드라이버 로드
    1. jvm → 드라이버로딩
2. 데이터베이스 연결
    1. DBMS→ DB명, ID/PW
3. SQL문 준비 및 실행
4. 데이터베이스 연결 끊음
    1. 서버컴퓨터를 끄지 않기 S때문에

## SpringBoot방식

- DB pg 참고

# SQL (Structured Query Language)

<aside>
💡 데이터베이스에서 데이터를 추출하고 조작하는 데에 사용하는 데이터 처리 언어

</aside>

### SQL특징

- 쿼리문은 대소문자 구별 없음
- 절차적 언어가 아니라 선언적 언어
- DBMS에 종속적이지 않음

- DML : 데이터 조작
    - CRUD (Create, Read, Update, Delete)
    - 웬만하면 이걸로 설명 끝
    
    ```sql
    INSERT INTO TABLE_NAME (A,B) VALUES('A','B')
    SELECT * FROM TABLE_NAME
    UPDATE TABLE_NAME SET A='A',B='B' WHERE ID =1
    DELETE FROM TABLE_NAME WHERE ID=1
    ```
    
- DDL : 데이터 정의
    
    ```sql
    CREATE TABLE `movies` (
    	`ID` int(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `Title` varchar(40) CHARACTER SET utf8mb4 NOT NULL,
        `Director` varchar(40) CHARACTER SET utf8mb4 NOT NULL,
        `Genre` varchar(40) CHARACTER SET utf8mb4 NOT NULL,
        `RunningTime` int(3) NOT NULL,
        `img` varchar(40) NULL
    )ENGINE=InnoDB;
    ```
    

### SELECT문 리딩순서

1. FROM
2. WHERE
3. GROUP BY
4. HAVING
5. SELECT
6. ORDER BY
7. LIMIT

## 자료형(data-type)

### 숫자 자료형(Numeric)

- double
- int

### 이진 자료형

- binary : 이진 문자열
- blob : 이진 데이터
    - 사진은 링크(주소)를 DB에 저장 : 폴더경로/파일이름

### 날짜 자료형

- DATE
- TIMESTAMP (DEFAULT CURRENT_TIMESTAMP)

### 문자 자료형

- CHAR(maximum)
- VARCHAR(maximum)

## DDL

```sql
CREATE DATABASE databasename;
SHOW DATABASES;
```

- 데이터베이스는 여러테이블을 포함

### 제약조건

- 컬럼에 저장될 데이터의 조건을 설정
- 무결성 : 제약조건에 위배되는 데이터는 저장 불가
- 테이블 생성시 컬럼에 지정하거나 constraint 로 지정 가능
    - NOT NULL
    - UNIQUE
    - PRIMARY KEY
    - FOREIGN KEY
    - DEFAULT
    - CHECK

### 스키마

- 테이블에 저장될 데이터 구조와 형식
- DESCRIBE 또는 DESC명령어 이용
    
    ![ERD.png](DB%2044641cf410264dedb8a33efec49d6ee8/ERD.png)
    

### 트랜잭션

- 커밋하거나 롤백할 수 잇는 가장 작은 작업 단위

### 내장함수

```sql
# MySQL 숫자 함수
# ㄴABS(): 숫자의 절댓값을 반환
# ㄴROUND(): 숫자를 반올림
# ㄴCEILING(): 숫자를 올림
# ㄴFLOOR(): 숫자를 내림
# ㄴMOD(): 나눗셈의 나머지를 계산
# ㄴSQRT(): 숫자의 제곱근을 계산
# ㄴPOW(): 숫자의 지수승을 계산

# MySQL 문자열 함수
# ㄴCONCAT(): 문자열을 연결
# ㄴSUBSTRING(): 문자열의 일부분을 추출
# ㄴUPPER(): 문자열을 모두 대문자로 변환
# ㄴLOWER(): 문자열을 모두 소문자로 변환
# ㄴLENGTH(): 문자열의 길이를 반환
# ㄴTRIM(): 문자열의 앞뒤 공백
# ㄴREPLACE(): 문자열에서 특정 문자열을 다른 문자열로 대체
# ㄴREPEAT(): 주어진 문자열을 지정된 횟수만큼 반복하여 반환
# ㄴREVERSE(): 문자열을 거꾸로 뒤집어서 반환

# MySQL 날짜 함수
# ㄴNOW(): 현재 날짜와 시간을 반환
# ㄴDATE(): 날짜 값에서 날짜 부분만 추출
# ㄴTIME(): 날짜 값에서 시간 부분만 추출
# ㄴYEAR(): 날짜 값에서 연도를 추출
# ㄴMONTH(): 날짜 값에서 월을 추출
# ㄴDAY(): 날짜 값에서 일을 추출
# ㄴDATE_FORMAT(): 날짜 값을 지정된 형식으로 포맷팅
```

## Join

- join의 조건 : PK및 FK로 구성
- INNER JOIN : 칼럼값이 양쪽 테이블 모두 존재하는 경우에
    - where 절만으로도 inner join 가능
- OUTER JOIN : **칼럼값이 한 쪽 테이블에만 존재하더라도** 조회 기준 테이블에 따라 LEFT OUTER JOIN, RIGHT OUTER JOIN으로 구분
    - 근데 굳이 둘다 쓸 필요 없이 LEFT를 쓰고, 기준에 따라 쓰는 순서만 바꾸면 됨.

→ 칼럼값이 없는 것도 조회하려면 OUTER, 있는 것만 조회하려면 INNER 쓰면 됨. 

## SubQuery

- SQL문 안에 포함되어있는 SQL문
- 중첩서브쿼리 - where절에 작성
- 인라인뷰 - from절에 작성
- 스칼라 서브쿼리 - selec문에 작성
- 반드시 ()로 감싼다.
- 서브쿼리는 단일 행 또는 다중 행 비교연산자와 함께 사용 가능
    - 단일 행은 서브쿼리 결과가 1건 나와야 함
    - 데이터 베이스가 클 때는 join보다 퍼포먼스가 좋을 때가 있음
- 원래 테이블에 없는 값으로 정렬하려면 서브쿼리를 써야 하지만, 다른 경우는 윈도우 함수를 썼을 때 퍼포먼스가 더 좋음

## 정규화

### 제1정규화

- 각 행의 속성은 하나의 값만 가진다

### 제2정규화

- 부분함수 종속 제거